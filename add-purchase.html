<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›’ ×”×•×¡×¤×ª ×§× ×™×™×”</title>

<style>
  #toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: #2563eb;
  color: white;
  padding: 16px 26px;
  border-radius: 14px;
  font-size: 1.2rem;
  box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s, transform 0.3s;
  z-index: 9999;
}
#toast.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}

  body {
    font-family: "Heebo", sans-serif;
    background: linear-gradient(135deg, #f3f6fb, #eef2ff);
    padding: 20px;
    text-align: center;
  }

  form {
    background: #fff;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    width: 90%;
    max-width: 420px;
    margin: auto;
  }

  input {
    width: 80%;
    padding: 10px;
    margin: 8px 0;
    border-radius: 8px;
    border: 1px solid #cbd5e1;
    font-size: 1rem;
  }

  button {
    background: #2563eb;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1rem;
    margin-top: 10px;
  }

  .categories {
    margin-top: 25px;
    text-align: center;
  }

  .cat-box {
    background: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 20px;
    width: 90%;
    max-width: 420px;
    margin-inline: auto;
  }

  .cat-box h3 {
    margin-top: 0;
    color: #1e3a8a;
  }

  .line {
  display: inline-block;
  padding: 6px 12px;
  margin: 6px;
  border-radius: 12px;
  border: 2px solid #086b05;
  background: #0a38b8;
  color: #ffffff;
  font-weight: bolder;
  font-size: 1rem;
  cursor: pointer;
  white-space: nowrap;
  transition: 0.2s;
}

.line:hover {
  background: #dbe8ff;
  transform: scale(1.05);
}

#cat-products,
#cat-prices,
#cat-stores {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}

</style>
</head>

<body>

<h2>ğŸ›’ ×”×•×¡×¤×ª ×§× ×™×™×” ×—×“×©×”</h2>

<form id="purchaseForm">
  <input id="store" placeholder="×©× ×‘×™×ª ×¢×¡×§" required>
  <input id="product" placeholder="×©× ××•×¦×¨" required>
  <input id="price" type="number" step="0.01" placeholder="××—×™×¨ (â‚ª)" required>

  <button type="submit">ğŸ’¾ ×©××•×¨</button>

  <!-- ×§×˜×’×•×¨×™×•×ª ×‘×ª×•×š ×”×§×•× ×˜×™×™× ×¨ -->
  <div class="categories">

 <div class="cat-box">
      <h3>ğŸª ×©××•×ª ×‘×ª×™ ×¢×¡×§</h3>
      <div id="cat-stores"></div>
    </div>

    <div class="cat-box">
      <h3>ğŸ“Œ ×©××•×ª ××•×¦×¨×™×</h3>
      <div id="cat-products"></div>
    </div>

    <div class="cat-box">
      <h3>ğŸ’° ××—×™×¨×™×</h3>
      <div id="cat-prices"></div>
    </div>


  </div>
</form>
<div id="toast">ğŸ’¾ × ×©××¨ ×‘×”×¦×œ×—×”!</div>

<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  const supabase = createClient(
    "https://tgfqsmarvznpzwdixvye.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRnZnFzbWFydnpucHp3ZGl4dnllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3OTM1NzEsImV4cCI6MjA3NjM2OTU3MX0.ui5rHWh8KgSmhYrl_unozb9rwAaZQeTNEeMZF63lhYM"
  );

  const form = document.getElementById("purchaseForm");

  const catProducts = document.getElementById("cat-products");
  const catPrices   = document.getElementById("cat-prices");
  const catStores   = document.getElementById("cat-stores");

  function loadLocalCategories() {
    const products = JSON.parse(localStorage.getItem("cat_products") || "[]");
    const prices   = JSON.parse(localStorage.getItem("cat_prices") || "[]");
    const stores   = JSON.parse(localStorage.getItem("cat_stores") || "[]");

    catProducts.innerHTML = "";
    products.forEach(p => addItemToBox(catProducts, p, "product"));

    catPrices.innerHTML = "";
    prices.forEach(p => addItemToBox(catPrices, p, "price"));

    catStores.innerHTML = "";
    stores.forEach(s => addItemToBox(catStores, s, "store"));
  }

  function addItemToBox(box, text, type) {
    const div = document.createElement("div");
    div.className = "line";
    div.textContent = text;

    div.addEventListener("click", () => {
      if (type === "product") document.getElementById("product").value = text;
      if (type === "price") document.getElementById("price").value = text.replace(" â‚ª","");
      if (type === "store") document.getElementById("store").value = text;
    });

    box.appendChild(div);
  }

  function saveToLocal(category, value) {
    const key = "cat_" + category;
    const arr = JSON.parse(localStorage.getItem(key) || "[]");

    if (!arr.includes(value)) {
      arr.push(value);
      localStorage.setItem(key, JSON.stringify(arr));
    }
  }

  function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");

  setTimeout(() => {
    toast.classList.remove("show");
  }, 2000); // × ×¢×œ× ××—×¨×™ 2 ×©× ×™×•×ª
}


  // ğŸŸ¦ ×©××™×¨×” ×œÖ¾Supabase + localStorage + ××™×œ×•×™ ×§×˜×’×•×¨×™×•×ª
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const store   = document.getElementById("store").value.trim();
    const product = document.getElementById("product").value.trim();
    const price   = document.getElementById("price").value.trim();
    const date    = new Date().toISOString();

    const { error } = await supabase.from("purchases").insert([
      {
        name: product,          // â† ×”×©×“×” ×”× ×›×•×Ÿ ××”×˜×‘×œ×” ×©×œ×š
        store_name: store,
        price,
        created_at: date
      }
    ]);

    if (error) {
      alert("âŒ ×©×’×™××” ×‘×©××™×¨×”!");
      console.error(error);
      return;
    }

    // ×©××™×¨×” ×‘Ö¾LocalStorage
    saveToLocal("products", product);
    saveToLocal("prices", price + " â‚ª");
    saveToLocal("stores", store);

    // ×¢×“×›×•×Ÿ ×§×˜×’×•×¨×™×•×ª
    loadLocalCategories();

    form.reset();

showToast("âœ… × ×©××¨ ×‘×”×¦×œ×—×”!");
  });

  loadLocalCategories();
</script>

</body>
</html>
